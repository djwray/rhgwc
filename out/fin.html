<SCRIPT LANGUAGE="JavaScript">
<!--
var originalUrl="http://i.loveruby.net/ja/rhg/book/fin.html";
var originalLp ="JAEN";
var originalDis="";
if (self.parent.excite_header.display) {
self.parent.excite_header.display.wb_url.value = originalUrl;
self.parent.excite_header.display.wb_lp.value = originalLp;
}
//-->
</SCRIPT>
<SCRIPT LANGUAGE="JavaScript">
<!--
if (top.excite_header)
{
// ok
}
else
{
top.location.href = "http://www.excite-webtl.jp/world/english/web/?wb_url=http%3A%2F%2Fi.loveruby.net%2Fja%2Frhg%2Fbook%2Ffin.html&wb_lp=JAEN&wb_dis=";
}
//-->
</SCRIPT>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html lang="ja-JP"> <head><base href=http://i.loveruby.net/ja/rhg/book/fin.html> <meta http-equiv="Content-Type" content="text/html; charset=Shift_JIS"> <meta http-equiv="Content-Language" content="ja-JP"> <link rel="stylesheet" type="text/css" href="rhg.css"> <link rev="made" href="mailto:aamine@loveruby.net"> <title>Chapter 20 The future of Ruby</title></head> <body> <h1>Chapter 20 The future of Ruby</h1> <h2>Problem to be solved</h2> <p> <code>Ruby</code> is not "Software that is finished. "Development is still on the way, and has a lot of problems. Let's remove the problem of existing inside a first of all present interpreter. The order of the topic is along in rough order in the chapter of this book. </p> <h3>Performance of GC</h3> <p>Will the performance of present GC be a place in which it was said, "Especially, it is not especially good though is not bad"?"Especially, it is not bad" is "Do not embarrass it because of daily life", and "Especially, it is not good" is a meaning "The weak point is exposed when becoming a high load". For instance, the speed decreases rapidly when it is an application that keeps being maintained making a large amount of objects. It is because of increasing further by the one that all objects will be marked at each GC, and the object cannot be collected up to the frequency of GC. GC according to the generation who touched in Chapter 5 must be effective in this problem (Come to it theoretically at least). </p> <p>Moreover, there is room for improvement also in the point of the rapidity of response. It sometimes hardens and the reaction will interrupt , saying that "[Gu]" while executing present GC as it is an editor when it is GUI application because the entire interpreter stops. It stops by might about 0.1 seconds the comparison it while the character is typed and the impression is very bad. Such an application is not so made now or this respect might not become a problem so much because it is not very large even in case of being. However, if the one said that along of it comes out, it is likely to have to think about the introduction of incremental GC as for either. </p> <h3>Mounting of parser</h3> <p>Mounting the parser of <code>ruby</code> has already overworked <code>yacc</code> to the vicinity of the limit, and doesn't seem to endure enhancing more than this as seen secondarily. The important person "Keyword argument" is scheduled to introduce, and it is not expressible of the grammar wanting it because of the limitation of <code>yacc</code>, and sad after this though is good if enhancing is not scheduled when becoming very much. </p> <h3>Recycling of parser</h3> <p>The parser of Ruby is very complex. Especially, it is very serious to treat around of <code>lex_state</code> seriously. It is very difficult to bury the Ruby program because of that, and to make the program that treats the Ruby program. </p> <p>For instance, it is a tool that the author is developing and there is the one named <code>racc</code>. R is put because it is Ruby version of <code>yacc</code> and <code>racc</code>. The syntax etc. of a grammatical file almost : in the <code>racc</code> It is the same as <code>yacc</code>, and only the part of the action code of Ruby. If it is not done that it is tidy ..code of Ruby.. Perth, it is very difficult to do "Neatly" Perth though it is not possible to judge for that. end of the actionIt compromises at the level that "Rough" Perth can do now because there is no other way. </p> <p>Besides, as an example of needing the analysis of the Ruby program The tool such as <code>indent</code> and <code>lint</code> is enumerated, and it has a hard time making such the one very much. It is already hopeless when becoming complex like the refactoring tool. </p> <p>Then, what shall we do?If it is impossible to try to make the same one, an original parser of <code>ruby</code> might be able to only have to be used as parts. Because in a word, parser of processing system is made libraryThis is a function wanting it by all means. </p> <p>However, to be doubtful here is not to make the parser reentrant as long as <code>yacc</code> is used. The reflexive cannot call and, in a word, call <code>yyparse()</code> from two or more threads. Therefore, it is necessary to mount so that the control should not return to Ruby in Perth. </p> <h3>Code concealment</h3> <p>Present <code>ruby</code> cannot be moved if there is no source code of the moved program. In a word, people who do not want to have others read the source code might be embarrassed. </p> <h3>Interpreter object</h3> <p>A present <code>ruby</code> interpreter was able to have only one in the process, and, then, it spoke in Chapter 13. Might this be able to be mounted really though that seems to be good if it is actually possible with two or more interpreters?</p> <h3>Structure of evaluation machine</h3> <p>Anyway, <code>eval.c</code> today is too complex. <code>Setjmp() It is ..former.. putting out of ..variety.. trouble to bury the stack frame of Ruby under the machine stack Rolling up by using longjmp()</code> also has lowered plainly and the speed. Especially, when it is RISC machine with a lot of registers The speed falls easily when it rolls it up by using <code>setjmp()</code>. It is because all registers are saved in <code>setjmp()</code>. </p> <h3>Speed of evaluation machine</h3> <p>[Ubunni] ..use.. is already high-speed enough usual <code>ruby</code>. However, goodness or more but yet faster it is the language processing system is correct. It might be good if it does very to do increasing the speed, that is, optimization. First of all, it is necessary to catch the profile at such time. Thus, it caught. </p> <pre class="emlist">
% cumulative self self total time seconds seconds calls ms/call ms/
call name 20.25 1.64 1.64 2638359 0.00 0.00 rb_eval 12.47 2.65 1.01 1
113947 0.00 0.00 ruby_re_match 8.89 3.37 0.72 5519249 0.00 0.00 rb_
call0 6.54 3.90 0.53 2156387 0.00 0.00 st_lookup 6.30 4.41 0.51 15990
96 0.00 0.00 rb_yield_0 5.43 4.85 0.44 5519249 0.00 0.00 rb_call 5.19 5.27 0.42 388066 0.00 0.00 st_foreach 3.46 5.55 0.28 8605866 0.00 0.0
0 rb_gc_mark 2.22 5.73 0.18 3819588 0.00 0.00 call_cfunc </pre> <p>This is a profile when a certain application is moved, and it is considerably near also the profile of a general Ruby program. GC appears in the top in a word at an overwhelming rate <code>rb_eval()</code>, and mixes with an evaluation machine center part and a function additionally peculiar to processing after that. For instance, the regular expression match in case of this application It seems to take a considerable time to <code>(ruby_re_match)</code>. </p> <p>However, it is assumed that it was understood and very solves it are the problems. If you think simply It only has to make <code>rb_eval()</code> fast, and there is little room for optimizing the clever-handed any longer for the core of <code>ruby</code> though it is likely to become. "Conversion ..end reflexive <code>Å®goto</code>.." used also does almost and has the feeling carried out in <code>NODE_IF</code>. There is no room for the improvement as long as those who think are not changed in a word fundamentally. </p> <h3>Mounting of thread</h3> <p>This spoke Chapter 19. As for mounting the thread of present ruby, there are quite a lot of problems. Especially, poor compatibility with native threads is helpless. The (1) portability of the <code>ruby</code> thread is isn't there impossibility in keeping the very use of that mounting for a long time high though the (2) two points of same anywhere behavior are merits that another doesn't certainly substitute easily?</p> <h2><code>ruby</code> 2</h2> <p>The trend of original <code>ruby</code> to these problems is this time continuously shown. </p> <h3>Rite</h3> <p>In the latest version of ruby, at present, the stability version is 1.6.7, and the development version is 1.7.3. However, the following stability version 1.8 puts out during no long way so and it exists. Then, 1.9.0 of the development versions starts at the same time. And, 1.9.1 becomes the stability versions for a moment irregularly as for the following. </p> <table> <tr><td>Stability version<td><td>Development version<td><td>Beginning time<td></tr> <tr><td>1.6.x<td><td>1.7.x<td><td>1.6.0 release to 2000-09-19. <td></tr> <tr><td>1.8.x<td><td>1.9.0<td><td>It is likely to go out within half a year. <td></tr> <tr><td>1.9.1Å`<td><td>2.0.0<td><td>Is it after for about two years?<td></tr> </table> <p>And, generation's development version is <code>ruby 2</code> one after another, code name Rite, and [dearu]. This name seems to be hommage to the Japanese to whom the distinction between L and R is not applied. </p> <p>2.0 in a single phrase is all ..most cores.. when saying where changes. The thread, the evaluation machine, the parser, and this change all. Because ..code.. [kakera] however has not come out, it is "Schedule. " writing to the end here all. It might be disappointed when expecting it too much. It lightly expects because of this, and I will make it. </p> <h3>Description language</h3> <p>Language first used. It is correct and C. mightAn English mailing list of Ruby According to the waited remark of original it with <code>ruby-talk</code></p> <blockquote> I hate C++. </blockquote> <p>First of all, it is impossible to use C++ because it puts it out. It should be done that time around of that doesn't increase because it is thought that the object system remains almost as it is no matter how it is said trying the overall make. The possibility of becoming ANSI C might be high this of ..C.. C however. </p> <h3>GC</h3> <p>From <code>Boehm GC\footnote</code> <code>Boehm GC http://www.hpl.hp.com/personal/Hans_Boehm/gc</code> to trial in mounting GC ..first of all..It is possible Boehm GC excellent to mark the stack area of all threads even if native threads move moreover by GC ..conservative, incremental, and generational.. GC considerably. It is likely to advance toward the direction where some rate improvements can be expected about either though it is understood whether neither assumption as the introduction once nor it keeps using Boehm GC. </p> <h3>Parser</h3> <p>The nest of the method call to omit parentheses might become a uniform prohibition in the point of the specification. <code>Command_call</code> had a considerable influence on a grammatical whole area as seen. If this is simplified, the parser and the scanner must be fairly refreshing. However, the omission of parentheses cannot be lost. </p> <p>It is still thinking whether it keeping using <code>yacc</code> on the mounting side. The one that only that is complex can be mounted by the hand if it doesn't use it or uneasiness remains. There is no difference in the thorny path even if either is chosen. </p> <h3>Evaluation machine</h3> <p>The evaluation machine completely becomes trying to make. The purpose is chiefly a simplification of speeding up and mounting, and the principal object is two points. </p> <ul> <li>The recursive call like <code>rb_eval()</code> is lost. </li> <li>Shift to bytecode interpreter</li> </ul> <p>First of all, the recursive call of <code>rb_eval()</code> is lost. Will it be the most intuitive to say that it will feel it the losing method like "Conversion ..end reflexive <code>Å®goto</code>.."?One Because of turn round and round by using <code>goto</code> in <code>rb_eval()</code>Then, the function call decreases first, and <code>setjmp()</code> used for <code>return</code> and <code>break</code> becomes unnecessary, too. However, because it cannot help calling the function even if it is unpleasant if the call of the method defined by C enters, <code>setjmp()</code> is still necessary in the delimitation. </p> <p>It is the one in bytecode (byte code) [yousuru] because like the program of the machine language. Because the instruction is composed of the term that became famous for a virtual machine of Smalltalk80 by each byte, it is called the bytecode. There are a lot of units of the bit in the machine language the instruction though byte unit seems to be natural judging from man who is always fiddling with the level above. For instance, when it is Alpha, six head bits of 32 instruction code bits show the instruction kind. </p> <p>The advantage of making it to the bytecode type is chiefly speed-up. The reason is 2, and the pointer need not be hauled in the first like the syntax tree. It optimizes it to another local It is easy it is to do (peephole optimization). </p> <p>Moreover, the bytecode is preserved and it is thought that it quickens somewhat there because Perth is lost when reading. However, Perth is work done only once at the time of beginning of the program, and because it doesn't originally take Perth time so much, doesn't have a so big influence. </p> <p>If it wants to know how the evaluation machine of the bytecode becomes it, you may see <code>regex.c</code>. Python is a bytecode interpreter. </p> <h3>Thread</h3> <p>The thread is for native threads. The environment that surrounded the thread compared with at that time in 1994 at the time of born Ruby might improve, and be judged to be able to go by native threads greatly. </p> <p>The respect is solved putting a global lock for the time being though C level should make the interpreter a safe MultiThreading as for the use of native threads because it becomes preemptive. </p> <p>It is a sign that seems to be very lost though it is known "Continuance" ..it and the knower... Continuance disappears naturally, too, if the thread becomes native threads because it greatly continues <code>ruby</code> according to mounting the thread. It is from "It is possible to mount" that that has adhered, and it might be unquestionable because it is hardly used. </p> <h3>M17N</h3> <p>I will touch incidentally only a little about the class library. Multilingualization As for (Multilingualization and M17N for short), it is ..putting out.. .. M17N is to be able to treat two or more character-codes in the programming when what you do is said to the having body. </p> <p>Because another has the internationalization (Internationalization and I18N for short) in the topic that looks like. If an example here is enumerated, the error message is produced in the language of user's favor, and the expression at the date is matched to the custom of the country. The achievement of M17N is indispensable to achieve I18N as savvied by this comparison. However, the opposite is not approved. </p> <p>What is necessary to make Ruby multilingual concretely?Two of the correspondences of <code>String</code> and <code>Regexp</code> are necessary ..correspond and another of the parser for one thing.. ..library related to the character string.. concrete. </p> <p>The correspondence of the parser is an arbitrary language in the comment, the string literal, and the regular expression literal (Encoding accurately) is permitted. This seems to be easy and is difficult. First of all, the method of telling encoding to the parser of <code>ruby</code> is necessary. After it comes off the parser without the exception, the program of Ruby is evaluated as we have seen. A usual syntax cannot be used to tell the parser encoding in a word. Therefore, it is necessary to add some syntaxes to specify encoding. </p> <p>Correspondence in the library is comparatively easy. The mechanism named <code>mbclen()</code> that is now has been obediently enhanced. </p> <p>M17N correspondence <code>ruby</code> has already been mounted, and is CVS [repojitori] It is possible to acquire it from the <code>ruby_m17n</code> branch. It is not taken though it was mounted because of having been judged that the specification is not mature. It might come as long as a good interface can be designed on the way of 1.9. </p> <h3>IO</h3> <p>This approach : though the <code>IO</code> class of present Ruby is a rapper of simple <code>stdio</code>. </p> <ul> <li>There are a lot of differences of the slight behavior between platforms. </li> <li>I want to control buffering in detail. </li> </ul> <p>There were dissatisfaction by two points. Then, it will have <code>stdio</code> in independence in Rite. </p> <h2>Ruby Hacking Guide</h2> <p>We have acted on here as a person who always observes <code>ruby</code> from the outside. However, <code>ruby</code> is of course different from the product put in the presentation case. That is, when we act and depend on not going, it is possible to influence here. The appeal to <code>ruby</code> proposed by the community is spoken, and now and the future of the paragraph at the this book end It is assumed the farewell gift to Ruby Hacker. </p> <h3>GC according to generation</h3> <p>First of all, Chapter 5 is GC according to the generation by touching Masato Kiyama. When it is a present patch as having already described</p> <ul> <li>The speed doesn't go out of the desire. </li> <li>It is necessary to update it according to latest <code>ruby</code>. </li> </ul> <p>I want to evaluate the point that it is the first, large-scale, informal patch in this place that the point is a problem high in above all. </p> <h3>Demon car</h3> <p>The regular expression engine that Ruby today uses is a remodeling version of GNU regex. That GNU regex was the one originally written for Emacs, and original who waited for the one that it was made multi byte correspondence further remodeled it to interchangeable Perl. It becomes a very complex, mysterious as easily from details imaginable structure. Moreover, this The license of <code>ruby</code> is very confusing because the license of GNU regexp is LGPL, and the replacement of this engine has become a problem beforehand. </p> <p>Then, having suddenly appeared is regular expression engine "Demon car. " with Kiyomi small Hasama's hand. This seems to be considerably good to be able to do, and seems to be taken into the main body at once. </p> <p>The demon car can be obtained by doing as follows from CVS [repojitori] of <code>ruby</code>. </p> <pre class="screen">
% cvs -d :pserver:anonymous@cvs.ruby-lang.org:/src co oniguruma </pre> <h3>ripper</h3> <p>It is continuously ripper of humble work. It is what remodels <code>parse.y</code> and makes to the enhancing library. It introduces it here as one directionality of making of the parser a component though it is not a change to the main body of <code>ruby</code>. </p> <p>It mounts by the interface of the stream system, and reduction with the scanning of the token or the parser can be picked up by the event form. I want you to use it for attachment CD-ROM with put ..\footnote:.. attachment CD-ROM <code>archives/ripper-0.0.5.tar.gz</code>'s. Because this version is the previous <code>ruby 1.7</code> base during half a year, it is a little different from the current grammar. </p> <p>"The idea has been hit on" nothing but thinks this was made comparatively ..that.. however ..the reason it.. it went well. The mounting time was indeed easily on about the third. </p> <h3>Alternative parser</h3> <p>The parser of Ruby is C++ and the person who is writing is <code>([ruby-talk:50497])</code> ..it seem to be.. though the shadow still is a product without shape either, too. <code></code></p> <h3>JRuby</h3> <p>In addition, the entire interpreter is extremely rewritten and there is movement of stripes food, too. For instance, the one Ruby written by Java "JRuby\footnote <code>JRuby http://jruby.sourceforge.net</code>" appears. It seems to mount in a considerable large household ..below Mr. Jan Arne Petersen... </p> <p>As an impression with which it fiddles for a moment</p> <ul> <li>The parser can be considerably tidied. Even [hiadokyumento] and slight blank behavior are reproduced accurately. </li> <li><code>Instance_eval</code> seems not to work. (Is this reluctant?)</li> <li>The built-in library is still few. (This is also reluctant. )</li> <li>The enhancing library cannot be used. (natural)</li> <li>Because everything is cut down, an existing script seems and the possibility of moving as it is seems to be low UNIX centric [natokoro] of Ruby. </li> <li>It is slow. </li> </ul> <p>Then, it seems to be able to say. It is about 20 times <code>ruby</code> original ..saying by the way how much the last "It is slow" is.. (The execution time :). When even here is slow, it is indeed painful. Because Ruby VM moves on Java VM, it must be still slow. There will be only waiting for the machine to become 20 X speed. </p> <p>However, the impression of consisting of the imagination for a long time well was received as a whole. </p> <h3>NETRuby</h3> <p>It is likely ..C#.. to move if it moves by Java. Written Ruby and it appeared in C#. <code></code>The author is Mr. arton. </p> <p>To author's hand. According to person in question's valve though only the source code is seen because there is no NET environment</p> <ul> <li>It is slow in above all. </li> <li>There are not so many class libraries. </li> <li>The interchangeability of the exception handling is not so good. </li> </ul> <p>Seem the problem around. However, <code>instance_eval</code> seems to move (astonishment). </p> <h3>To participate in the development of <code>ruby</code></h3> <p>The developer of <code>ruby</code> is [matsumo], [yukihirosan] individual to the end, and it is final There is an absolute authority about the direction of <code>ruby</code>. However, <code>ruby</code> is open source software at the same time, and everyone can participate in development. It can propose the opinion and, because, the patch be put out it is possible to participate. A concrete participation method is spoken as follows. </p> <p>You should participate in each mailing list for <code>ruby</code> because development is advanced around the mailing list. The mailing list that is the center of the present community It is three ( <code>ruby-list</code>, <code>ruby-dev</code>, and <code>ruby-talk</code>). <code>Ruby-list</code> It is a mailing list of "Anything is OK if relating to Ruby", and Japanese. <code>Ruby-dev</code> is a mailing list that tells the story of development version <code>ruby</code>, and this is Japanese. <code>Ruby-talk</code> is an English mailing list. The participation method is recorded on the page of "Mailing list" of <code>http://www.ruby-lang.org/ja ..:../</code>These mailing lists participate for a while for the time being because the member only of reading all is a welcome, look at the discussion, and are ..capture.. [mutoii] as for atmosphere. </p> <p>It might be said recently, "Leadership moved to <code>ruby-talk</code>" though it was Ruby that the activity starts from Japan. However, there is no change in <code>ruby-dev</code> as usual the center of development. Anyway, Speaking purposely in English because of a Japanese user most men (That is, core member) who have the committing right of <code>ruby</code> is also troublesome, and the foot turns to nature and <code>ruby-dev</code>. The core of the <code>ruby</code> development will be <code>ruby-dev</code> for the time being though the situation might change, too, if the number of core members who will use English in the future increases. </p> <p>However, now because not being possible to participate in development is also embarrassed if Japanese cannot be used The summary of <code>ruby-dev</code> is translated into English once a week and it throws into <code>ruby-talk</code>. It is very severe because it does by three people's carrying about now though the author also is participating in the summary. The member who helps the summary is always recruiting it. As for my [kosoha] and [omo] [ukata], I would like you to do the participation declaration with <code>ruby-list</code> by all means. </p> <p>And, software is not the one that there only haves to be a source code at the end either. It is necessary to maintain various documents and websites. And, the person who does this is always lack. It only has to be said, "I want to do something" with <code>ruby-list</code> for the time being though there is a mailing list for [moichiou] [**] in the activity related to the document. It is likely to make the author answer as much as possible, too and to react also by other members. </p> <h3>At the end</h3> <p>Well, long this book ends by this, too. It talked about all bases of <code>ruby</code> though it did not go kindly and politely in all the parts because there was a balance with the number of pages, too completely. Adding [udauda] any further seems to be good. I want you to confirm it reading the source code until consenting if it has not understood yet by yourself. </p> <hr> <p>The point of an opinion, an impression, and a mis-plant etc. are <a href="http://www.excite-webtl.jp/world/english/web/body/?wb_url=http%3A%2F%2Fi.loveruby.net%2Fja%2Frhg%2Fbook%2Fmailto%3Aaamine%40loveruby.net&wb_lp=JAEN&wb_dis=2">[mine**] Aoki Thank you very much even for &lt; aamine@loveruby.net &gt;</a>. </p> <p> <a href="http://www.excite-webtl.jp/world/english/web/body/?wb_url=http%3A%2F%2Fdirect.ips.co.jp%2Fdirectsys%2Fgo_x_TempChoice.cfm%3Fsh_id%3DEE0040%26amp%3Bspm_id%3D1%26amp%3BGM_ID%3D1721&wb_lp=JAEN&wb_dis=2">It is possible to reserve ..direct ..'Ruby source code complete explanation'.. IMPRESS it.. and to buy it (Fly to the book introduction page. )</a> </p> <p>Copyright (c) 2002-2004 Minero Aoki, All rights reserved.</p> </body> </html>
<script src="http://rep.excite-webtl.jp/urchin.js" type="text/javascript"></script>
<script type="text/javascript">
_udn="excite-webtl.jp";
urchinTracker();
</script>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
var pageTracker = _gat._getTracker("UA-400370-52");
pageTracker._initData();
pageTracker._trackPageview();
</script>
